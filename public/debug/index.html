<html>
<head>
    <script src="/debug/socket.io.js"></script>
    <script src="/debug/jquery.min.js"></script>
    <script>
        var width = 21, height = 11;

        $(function() {
            var socket = io();

            var ship = {
                position: {
                    x: 0,
                    y: 0
                }
            };

            socket.on('game:created', function(a) {
                $('#gameid').html(a);
            });

            socket.on('game:ended', function(details) {
                alert('GAME OVER....' + details.reason);
            });

            var enemies = {};

            socket.on('ship:position', function(pos) {
                $('#cell_' + ship.position.x + '_' + ship.position.y).html('');
                ship.position = pos;
                $('#cell_0_' + pos.y).html('SHIP!');
            });

            socket.on('ship:status', function(ship) {
                if (ship.health !== undefined && ship.health.life !== undefined && ship.health.shields !== undefined) {
                    $('#life span').html(ship.health.life);
                    $('#shields span').html(ship.health.shields);
                }
            });

            socket.on('enemy:position', function(enemy) {
                if (enemies[enemy.id] === undefined)
                    enemies[enemy.id] = {};
                if (enemies[enemy.id].position !== undefined)
                    $('#cell_' + enemies[enemy.id].position.x + '_' + enemies[enemy.id].position.y).html('');
                if (!(enemy.position.x === ship.position.x && enemy.position.y === ship.position.y)) {
                    enemies[enemy.id].position = enemy.position;
                    $('#cell_' + enemy.position.x + '_' + enemy.position.y).html('ENEMY!');
                }
            });

            socket.emit('game:create');

            $('#up').on('click', function() {
                socket.emit('ship:move:up');
            });
            $('#down').on('click', function() {
                socket.emit('ship:move:down');
            });

            for (var y = 0; y < height; y++) {
                for (var x = 0; x < width; x++) {
                    $('#grid').append('<div class="cell" id="cell_' + x + '_' + y + '" style="width:' + 100/width + '%;height:' + 100/(height+1) + '%;float:left;box-sizing:border-box;border:1px solid black;"/>');
                }
            }
        });

    </script>


</head>
<body>
    <div id="grid">

    </div>
    <div style="float:left">
        <div id="gameid" style:"float:left;"></div>
        <div id="up" style="width:50px;height:50px;background:yellow;float:left;">Up</div>
        <div id="down" style="width:50px;height:50px;background:red;float:left;">Down</div>
        <div id="life" style:"float:left;">Life<span></span></div>
        <div id="shields" style:"float:left;">Shields<span></span></div>
    </div>

</body>
</html>
